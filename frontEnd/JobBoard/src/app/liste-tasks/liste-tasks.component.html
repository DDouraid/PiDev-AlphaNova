<div class="content-body">
    <div class="container-fluid">
        <h2 class="text-center my-4">Tasks List</h2>

        <!-- Button to open add modal -->
        <div class="container d-flex justify-content-end mb-3">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTaskModal">
                <i class="bi bi-plus-circle me-2"></i>Add New Task
            </button>
        </div>

        <!-- Tasks list -->
        <div class="container d-flex justify-content-center">
            <div class="table-responsive" style="max-width: 90%;">
                <table
                    class="table table-bordered table-hover table-striped text-center align-middle shadow-lg rounded">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let task of listTasks">
                            <td>{{ task.id }}</td>
                            <td class="text-truncate" style="max-width: 150px;">{{ task.title }}</td>
                            <td class="text-truncate" style="max-width: 200px;">{{ task.description }}</td>
                            <td>{{ task.startDate | date }}</td>
                            <td>{{ task.endDate | date }}</td>
                            <td>{{ task.status }}</td>
                            <td>
                                <button class="btn btn-warning btn-sm me-2" data-bs-toggle="modal"
                                    data-bs-target="#updateTaskModal" (click)="selectTaskForUpdate(task)">
                                    <i class="bi bi-pencil-square"></i> Update
                                </button>
                                <button class="btn btn-danger btn-sm" (click)="deleteTask(task.id)">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Message if no tasks found -->
        <div *ngIf="listTasks.length === 0" class="alert alert-warning text-center mt-3">
            No tasks found.
        </div>
    </div>

    <!-- Modal to add a task -->
    <div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addTaskModalLabel">Add New Task</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form (ngSubmit)="addTask()" #taskForm="ngForm">
                        <div class="mb-3">
                            <label for="title" class="form-label">Title</label>
                            <input class="form-control" id="title" name="title" [(ngModel)]="newTask.title" required />
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="4"
                                [(ngModel)]="newTask.description" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate" name="startDate"
                                [(ngModel)]="newTask.startDate" required />
                        </div>
                        <div class="mb-3">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate" name="endDate"
                                [(ngModel)]="newTask.endDate" required />
                        </div>
                        <div class="mb-3">
                            <label for="status" class="form-label">Status</label>
                            <select class="form-select" id="status" name="status" [(ngModel)]="newTask.status" required>
                                <option value="" disabled selected>Choose a status</option>
                                <option [ngValue]="TasksStatus.TODO">TODO</option>
                                <option [ngValue]="TasksStatus.IN_PROGRESS">IN PROGRESS</option>
                                <option [ngValue]="TasksStatus.DONE">DONE</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-success" [disabled]="!taskForm.valid">
                                <i class="bi bi-check-circle me-2"></i>Submit
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal to update a task -->
    <div class="modal fade" id="updateTaskModal" tabindex="-1" aria-labelledby="updateTaskModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title" id="updateTaskModalLabel">Update Task</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form (ngSubmit)="updateTask()" #updateTaskForm="ngForm">
                        <div class="mb-3">
                            <label for="updateTitle" class="form-label">Title</label>
                            <input class="form-control" id="updateTitle" name="title" [(ngModel)]="selectedTask.title"
                                required />
                        </div>
                        <div class="mb-3">
                            <label for="updateDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="updateDescription" name="description" rows="4"
                                [(ngModel)]="selectedTask.description" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="updateStartDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="updateStartDate" name="startDate"
                                [(ngModel)]="selectedTask.startDate" required />
                        </div>
                        <div class="mb-3">
                            <label for="updateEndDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="updateEndDate" name="endDate"
                                [(ngModel)]="selectedTask.endDate" required />
                        </div>
                        <div class="mb-3">
                            <label for="updateStatus" class="form-label">Status</label>
                            <select class="form-select" id="updateStatus" name="status"
                                [(ngModel)]="selectedTask.status" required>
                                <option value="" disabled selected>Choose a status</option>
                                <option [ngValue]="TasksStatus.TODO">TODO</option>
                                <option [ngValue]="TasksStatus.IN_PROGRESS">IN PROGRESS</option>
                                <option [ngValue]="TasksStatus.DONE">DONE</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-success" [disabled]="!updateTaskForm.valid"
                                (click)="updateTaskForm.valid ? closeUpdateModal() : null">
                                <i class="bi bi-check-circle me-2"></i>Update
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>